package irctcflight;


import java.io.File;
import java.nio.file.Files;
import java.nio.file.StandardCopyOption;
import java.time.Duration;
import java.time.LocalDate;
import java.util.List;

import org.openqa.selenium.By;
import org.openqa.selenium.JavascriptExecutor;
import org.openqa.selenium.OutputType;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.chrome.ChromeDriver;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.Select;
import org.openqa.selenium.support.ui.WebDriverWait;

 
public class FlightSearchAutomation {
 
	public static void main(String[] args) throws InterruptedException {
		ChromeDriver driver = new ChromeDriver();
        WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(10));
 
		driver.get("https://www.air.irctc.co.in/");
		driver.manage().window().maximize();
		
//		1)Select Hydrabad
		WebElement hyderabad = driver.findElement(By.id("stationFrom"));
		hyderabad.click();
//		hydrabad.sendKeys("Hyd");
 
        WebElement origin = wait.until(ExpectedConditions.visibilityOfElementLocated(By.xpath("//ul[@id='ui-id-1']/li[8]/div")));
        JavascriptExecutor js = (JavascriptExecutor) driver;
        js.executeScript("arguments[0].click();", origin);

//      2)Select Pune 
        WebElement pune = driver.findElement(By.id("stationTo"));
        pune.click();  
//        pune.sendKeys("PNQ");
        WebElement destinaton = wait.until(ExpectedConditions.visibilityOfElementLocated(By.xpath("//ul[@id='ui-id-2']/li[7]/div")));
        js.executeScript("arguments[0].click();", destinaton);
		
//		3) select todays date 
		driver.findElement(By.id("originDate")).click();
		String today = String.valueOf(LocalDate.now().getDayOfMonth());
//		String tomorrow = String.valueOf(LocalDate.now().plusDays(1).getDayOfMonth());
		List<WebElement> dates = driver.findElements(By.xpath("//td[@class='date']//span[contains(@class,'act')]"));
		for(WebElement date : dates) {
//			if(date.getText().trim().startsWith(tomorrow))
			if(date.getText().trim().startsWith(today))
			{
				date.click();
				break;
			}
		}
//		4) Select BusinessClass 
		WebElement economy = driver.findElement(By.xpath("//input[@id='noOfpaxEtc']"));
		economy.click();
		WebElement travelClassDropdown = driver.findElement(By.id("travelClass"));
		Select select = new Select(travelClassDropdown);
		select.selectByVisibleText("Business");
 
//		5) Search Button 
		WebElement searchBtn = driver.findElement(By.xpath("//button[normalize-space()='Search']"));
		searchBtn.click();
 
		Thread.sleep(5000);		

// 		7) Displaying Data On the Console
		
		List<WebElement> flights = driver.findElements(By.xpath("//div[contains(@class,'right-searchbarbtm-in')]"));
		if(flights.size()==0) {
			System.out.println("No flights found for the selected route and date");
		}else {
			for(WebElement flight : flights) {
				try {
					String flightName = flight.findElement(By.xpath(".//b")).getText();
					String price = flight.findElement(By.xpath(".//label[contains(@class,'price')]")).getText();
					System.out.println("Flight :" + flightName + "| Price :" + price);
				}catch(Exception e) {
				}
			}
		}
		
	//8)Closing the Browser:
	driver.quit();
	System.out.println("Ticket Checking Completed..... | Browser Closed");
 
		

 
		
 
	}
 
}